{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"@babel/runtime/helpers/defineProperty\");\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar _assert = _interopRequireDefault(require(\"assert\"));\nvar _resolveFrom = _interopRequireDefault(require(\"resolve-from\"));\nvar Log = _interopRequireWildcard(require(\"../../log\"));\nvar _fileNotifier = require(\"../../utils/FileNotifier\");\nvar _delay = require(\"../../utils/delay\");\nvar _env = require(\"../../utils/env\");\nvar _errors = require(\"../../utils/errors\");\nvar _open = require(\"../../utils/open\");\nvar _asyncNgrok = require(\"./AsyncNgrok\");\nvar _developmentSession = require(\"./DevelopmentSession\");\nvar _urlCreator = require(\"./UrlCreator\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n          if (desc.get || desc.set) {\n            Object.defineProperty(newObj, key, desc);\n          } else {\n            newObj[key] = obj[key];\n          }\n        }\n      }\n    }\n    newObj.default = obj;\n    return newObj;\n  }\n}\nvar debug = require(\"debug\")(\"expo:start:server:devServer\");\nvar PLATFORM_MANAGERS = {\n  simulator: function simulator() {\n    return require(\"../platforms/ios/ApplePlatformManager\").ApplePlatformManager;\n  },\n  emulator: function emulator() {\n    return require(\"../platforms/android/AndroidPlatformManager\").AndroidPlatformManager;\n  }\n};\nvar MIDDLEWARES = {\n  classic: function classic() {\n    return require(\"./middleware/ClassicManifestMiddleware\").ClassicManifestMiddleware;\n  },\n  \"expo-updates\": function expoUpdates() {\n    return require(\"./middleware/ExpoGoManifestHandlerMiddleware\").ExpoGoManifestHandlerMiddleware;\n  }\n};\nvar BundlerDevServer = function () {\n  function BundlerDevServer(projectRoot, platformBundlers, isDevClient) {\n    _classCallCheck(this, BundlerDevServer);\n    this.projectRoot = projectRoot;\n    this.platformBundlers = platformBundlers;\n    this.isDevClient = isDevClient;\n    this.ngrok = null;\n    this.devSession = null;\n    this.instance = null;\n    this.platformManagers = {};\n    this.urlCreator = null;\n    this.notifier = null;\n  }\n  _createClass(BundlerDevServer, [{\n    key: \"setInstance\",\n    value: function setInstance(instance) {\n      this.instance = instance;\n    }\n  }, {\n    key: \"getManifestMiddlewareAsync\",\n    value: function () {\n      var _getManifestMiddlewareAsync = _asyncToGenerator(function* () {\n        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        var manifestType = options.forceManifestType || \"classic\";\n        (0, _assert).default(manifestType in MIDDLEWARES, `Manifest middleware for type '${manifestType}' not found`);\n        var Middleware = MIDDLEWARES[manifestType]();\n        var urlCreator = this.getUrlCreator();\n        var middleware = new Middleware(this.projectRoot, {\n          constructUrl: urlCreator.constructUrl.bind(urlCreator),\n          mode: options.mode,\n          minify: options.minify,\n          isNativeWebpack: this.name === \"webpack\" && this.isTargetingNative(),\n          privateKeyPath: options.privateKeyPath\n        });\n        return middleware;\n      });\n      function getManifestMiddlewareAsync() {\n        return _getManifestMiddlewareAsync.apply(this, arguments);\n      }\n      return getManifestMiddlewareAsync;\n    }()\n  }, {\n    key: \"startAsync\",\n    value: function () {\n      var _startAsync = _asyncToGenerator(function* (options) {\n        yield this.stopAsync();\n        var instance;\n        if (options.headless) {\n          instance = yield this.startHeadlessAsync(options);\n        } else {\n          instance = yield this.startImplementationAsync(options);\n        }\n        this.setInstance(instance);\n        yield this.postStartAsync(options);\n        return instance;\n      });\n      function startAsync(_x) {\n        return _startAsync.apply(this, arguments);\n      }\n      return startAsync;\n    }()\n  }, {\n    key: \"waitForTypeScriptAsync\",\n    value: function () {\n      var _waitForTypeScriptAsync = _asyncToGenerator(function* () {\n        return false;\n      });\n      function waitForTypeScriptAsync() {\n        return _waitForTypeScriptAsync.apply(this, arguments);\n      }\n      return waitForTypeScriptAsync;\n    }()\n  }, {\n    key: \"watchEnvironmentVariables\",\n    value: function () {\n      var _watchEnvironmentVariables = _asyncToGenerator(function* () {});\n      function watchEnvironmentVariables() {\n        return _watchEnvironmentVariables.apply(this, arguments);\n      }\n      return watchEnvironmentVariables;\n    }()\n  }, {\n    key: \"startHeadlessAsync\",\n    value: function () {\n      var _startHeadlessAsync = _asyncToGenerator(function* (options) {\n        var _this = this;\n        if (!options.port) throw new _errors.CommandError(\"HEADLESS_SERVER\", \"headless dev server requires a port option\");\n        this.urlCreator = this.getUrlCreator(options);\n        return {\n          server: {\n            close: function close() {\n              _this.instance = null;\n            },\n            addListener: function addListener() {}\n          },\n          location: {\n            port: options.port,\n            host: \"localhost\",\n            url: `http://localhost:${options.port}`,\n            protocol: \"http\"\n          },\n          middleware: {},\n          messageSocket: {\n            broadcast: function broadcast() {\n              throw new _errors.CommandError(\"HEADLESS_SERVER\", \"Cannot broadcast messages to headless server\");\n            }\n          }\n        };\n      });\n      function startHeadlessAsync(_x2) {\n        return _startHeadlessAsync.apply(this, arguments);\n      }\n      return startHeadlessAsync;\n    }()\n  }, {\n    key: \"postStartAsync\",\n    value: function () {\n      var _postStartAsync = _asyncToGenerator(function* (options) {\n        if (options.location.hostType === \"tunnel\" && !_env.env.EXPO_OFFLINE && this.isTargetingNative()) {\n          yield this._startTunnelAsync();\n        }\n        yield this.startDevSessionAsync();\n        this.watchConfig();\n      });\n      function postStartAsync(_x3) {\n        return _postStartAsync.apply(this, arguments);\n      }\n      return postStartAsync;\n    }()\n  }, {\n    key: \"watchConfig\",\n    value: function watchConfig() {\n      var ref;\n      (ref = this.notifier) == null ? void 0 : ref.stopObserving();\n      this.notifier = new _fileNotifier.FileNotifier(this.projectRoot, this.getConfigModuleIds());\n      this.notifier.startObserving();\n    }\n  }, {\n    key: \"_startTunnelAsync\",\n    value: function () {\n      var _startTunnelAsync2 = _asyncToGenerator(function* () {\n        var ref;\n        var port = (ref = this.getInstance()) == null ? void 0 : ref.location.port;\n        if (!port) return null;\n        debug(\"[ngrok] connect to port: \" + port);\n        this.ngrok = new _asyncNgrok.AsyncNgrok(this.projectRoot, port);\n        yield this.ngrok.startAsync();\n        return this.ngrok;\n      });\n      function _startTunnelAsync() {\n        return _startTunnelAsync2.apply(this, arguments);\n      }\n      return _startTunnelAsync;\n    }()\n  }, {\n    key: \"startDevSessionAsync\",\n    value: function () {\n      var _startDevSessionAsync = _asyncToGenerator(function* () {\n        var _this2 = this;\n        var ref1;\n        (ref1 = this.devSession) == null ? void 0 : ref1.stopNotifying == null ? void 0 : ref1.stopNotifying();\n        this.devSession = new _developmentSession.DevelopmentSession(this.projectRoot, this.isTargetingNative() ? this.getNativeRuntimeUrl() : this.getDevServerUrl({\n          hostType: \"localhost\"\n        }), function () {\n          var ref;\n          (ref = _this2.devSession) == null ? void 0 : ref.closeAsync().catch(function (error) {\n            debug(\"[dev-session] error closing: \" + error.message);\n          });\n        });\n        yield this.devSession.startAsync({\n          runtime: this.isTargetingNative() ? \"native\" : \"web\"\n        });\n      });\n      function startDevSessionAsync() {\n        return _startDevSessionAsync.apply(this, arguments);\n      }\n      return startDevSessionAsync;\n    }()\n  }, {\n    key: \"isTargetingNative\",\n    value: function isTargetingNative() {\n      return true;\n    }\n  }, {\n    key: \"isTargetingWeb\",\n    value: function isTargetingWeb() {\n      return this.platformBundlers.web === this.name;\n    }\n  }, {\n    key: \"broadcastMessage\",\n    value: function broadcastMessage(method, params) {\n      var ref;\n      (ref = this.getInstance()) == null ? void 0 : ref.messageSocket.broadcast(method, params);\n    }\n  }, {\n    key: \"getInstance\",\n    value: function getInstance() {\n      return this.instance;\n    }\n  }, {\n    key: \"stopAsync\",\n    value: function () {\n      var _stopAsync = _asyncToGenerator(function* () {\n        var _this3 = this;\n        var ref4, ref2, ref3;\n        (ref4 = this.notifier) == null ? void 0 : ref4.stopObserving();\n        yield (ref2 = this.devSession) == null ? void 0 : ref2.closeAsync();\n        yield (ref3 = this.ngrok) == null ? void 0 : ref3.stopAsync().catch(function (e) {\n          Log.error(`Error stopping ngrok:`);\n          Log.exception(e);\n        });\n        return (0, _delay).resolveWithTimeout(function () {\n          return new Promise(function (resolve, reject) {\n            var ref;\n            debug(`Stopping dev server (bundler: ${_this3.name})`);\n            if ((ref = _this3.instance) == null ? void 0 : ref.server) {\n              _this3.instance.server.close(function (error) {\n                debug(`Stopped dev server (bundler: ${_this3.name})`);\n                _this3.instance = null;\n                if (error) {\n                  reject(error);\n                } else {\n                  resolve();\n                }\n              });\n            } else {\n              debug(`Stopped dev server (bundler: ${_this3.name})`);\n              _this3.instance = null;\n              resolve();\n            }\n          });\n        }, {\n          timeout: 1000,\n          errorMessage: `Timeout waiting for '${this.name}' dev server to close`\n        });\n      });\n      function stopAsync() {\n        return _stopAsync.apply(this, arguments);\n      }\n      return stopAsync;\n    }()\n  }, {\n    key: \"getUrlCreator\",\n    value: function getUrlCreator() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (!this.urlCreator) {\n        (0, _assert).default(options == null ? void 0 : options.port, \"Dev server instance not found\");\n        this.urlCreator = new _urlCreator.UrlCreator(options.location, {\n          port: options.port,\n          getTunnelUrl: this.getTunnelUrl.bind(this)\n        });\n      }\n      return this.urlCreator;\n    }\n  }, {\n    key: \"getNativeRuntimeUrl\",\n    value: function getNativeRuntimeUrl() {\n      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var ref;\n      return this.isDevClient ? (ref = this.getUrlCreator().constructDevClientUrl(opts)) != null ? ref : this.getDevServerUrl() : this.getUrlCreator().constructUrl(_objectSpread(_objectSpread({}, opts), {}, {\n        scheme: \"exp\"\n      }));\n    }\n  }, {\n    key: \"getDevServerUrl\",\n    value: function getDevServerUrl() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var instance = this.getInstance();\n      if (!(instance == null ? void 0 : instance.location)) {\n        return null;\n      }\n      var location = instance.location;\n      if (options.hostType === \"localhost\") {\n        return `${location.protocol}://localhost:${location.port}`;\n      }\n      var _url;\n      return (_url = location.url) != null ? _url : null;\n    }\n  }, {\n    key: \"getJsInspectorBaseUrl\",\n    value: function getJsInspectorBaseUrl() {\n      if (this.name !== \"metro\") {\n        throw new _errors.CommandError(\"DEV_SERVER\", `Cannot get the JS inspector base url - bundler[${this.name}]`);\n      }\n      return this.getUrlCreator().constructUrl({\n        scheme: \"http\"\n      });\n    }\n  }, {\n    key: \"getTunnelUrl\",\n    value: function getTunnelUrl() {\n      var ref;\n      var ref5;\n      return (ref5 = (ref = this.ngrok) == null ? void 0 : ref.getActiveUrl()) != null ? ref5 : null;\n    }\n  }, {\n    key: \"openPlatformAsync\",\n    value: function () {\n      var _openPlatformAsync = _asyncToGenerator(function* (launchTarget) {\n        var resolver = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        if (launchTarget === \"desktop\") {\n          var serverUrl = this.getDevServerUrl({\n            hostType: \"localhost\"\n          });\n          var ref;\n          var url = this.name === \"metro\" ? (ref = this.getTunnelUrl()) != null ? ref : serverUrl : serverUrl;\n          yield (0, _open).openBrowserAsync(url);\n          return {\n            url: url\n          };\n        }\n        var runtime = this.isTargetingNative() ? this.isDevClient ? \"custom\" : \"expo\" : \"web\";\n        var manager = yield this.getPlatformManagerAsync(launchTarget);\n        return manager.openAsync({\n          runtime: runtime\n        }, resolver);\n      });\n      function openPlatformAsync(_x4) {\n        return _openPlatformAsync.apply(this, arguments);\n      }\n      return openPlatformAsync;\n    }()\n  }, {\n    key: \"openCustomRuntimeAsync\",\n    value: function () {\n      var _openCustomRuntimeAsync = _asyncToGenerator(function* (launchTarget) {\n        var launchProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        var resolver = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        var runtime = this.isTargetingNative() ? this.isDevClient ? \"custom\" : \"expo\" : \"web\";\n        if (runtime !== \"custom\") {\n          throw new _errors.CommandError(`dev server cannot open custom runtimes either because it does not target native platforms or because it is not targeting dev clients. (target: ${runtime})`);\n        }\n        var manager = yield this.getPlatformManagerAsync(launchTarget);\n        return manager.openAsync({\n          runtime: \"custom\",\n          props: launchProps\n        }, resolver);\n      });\n      function openCustomRuntimeAsync(_x5) {\n        return _openCustomRuntimeAsync.apply(this, arguments);\n      }\n      return openCustomRuntimeAsync;\n    }()\n  }, {\n    key: \"getExpoGoUrl\",\n    value: function getExpoGoUrl() {\n      return this.getUrlCreator().constructUrl({\n        scheme: \"exp\"\n      });\n    }\n  }, {\n    key: \"isRedirectPageEnabled\",\n    value: function isRedirectPageEnabled() {\n      return !_env.env.EXPO_NO_REDIRECT_PAGE && !this.isDevClient && !!_resolveFrom.default.silent(this.projectRoot, \"expo-dev-client\");\n    }\n  }, {\n    key: \"getRedirectUrl\",\n    value: function getRedirectUrl() {\n      var platform = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      if (!this.isRedirectPageEnabled()) {\n        debug(\"Redirect page is disabled\");\n        return null;\n      }\n      var ref;\n      return (ref = this.getUrlCreator().constructLoadingUrl({}, platform === \"emulator\" ? \"android\" : platform === \"simulator\" ? \"ios\" : null)) != null ? ref : null;\n    }\n  }, {\n    key: \"getReactDevToolsUrl\",\n    value: function getReactDevToolsUrl() {\n      return new URL(\"_expo/react-devtools\", this.getUrlCreator().constructUrl({\n        scheme: \"http\"\n      })).toString();\n    }\n  }, {\n    key: \"getPlatformManagerAsync\",\n    value: function () {\n      var _getPlatformManagerAsync = _asyncToGenerator(function* (platform) {\n        if (!this.platformManagers[platform]) {\n          var ref;\n          var Manager = PLATFORM_MANAGERS[platform]();\n          var port = (ref = this.getInstance()) == null ? void 0 : ref.location.port;\n          if (!port || !this.urlCreator) {\n            throw new _errors.CommandError(\"DEV_SERVER\", \"Cannot interact with native platforms until dev server has started\");\n          }\n          debug(`Creating platform manager (platform: ${platform}, port: ${port})`);\n          this.platformManagers[platform] = new Manager(this.projectRoot, port, {\n            getCustomRuntimeUrl: this.urlCreator.constructDevClientUrl.bind(this.urlCreator),\n            getExpoGoUrl: this.getExpoGoUrl.bind(this),\n            getRedirectUrl: this.getRedirectUrl.bind(this, platform),\n            getDevServerUrl: this.getDevServerUrl.bind(this, {\n              hostType: \"localhost\"\n            })\n          });\n        }\n        return this.platformManagers[platform];\n      });\n      function getPlatformManagerAsync(_x6) {\n        return _getPlatformManagerAsync.apply(this, arguments);\n      }\n      return getPlatformManagerAsync;\n    }()\n  }]);\n  return BundlerDevServer;\n}();\nexports.BundlerDevServer = BundlerDevServer;","map":{"version":3,"names":["_defineProperty","require","_asyncToGenerator","_classCallCheck","_createClass","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","_assert","_interopRequireDefault","_resolveFrom","Log","_interopRequireWildcard","_fileNotifier","_delay","_env","_errors","_open","_asyncNgrok","_developmentSession","_urlCreator","debug","PLATFORM_MANAGERS","simulator","ApplePlatformManager","emulator","AndroidPlatformManager","MIDDLEWARES","classic","ClassicManifestMiddleware","expoUpdates","ExpoGoManifestHandlerMiddleware","BundlerDevServer","projectRoot","platformBundlers","isDevClient","ngrok","devSession","instance","platformManagers","urlCreator","notifier","key","value","setInstance","_getManifestMiddlewareAsync","options","undefined","manifestType","forceManifestType","default","Middleware","getUrlCreator","middleware","constructUrl","bind","mode","minify","isNativeWebpack","name","isTargetingNative","privateKeyPath","getManifestMiddlewareAsync","_startAsync","stopAsync","headless","startHeadlessAsync","startImplementationAsync","postStartAsync","startAsync","_x","_waitForTypeScriptAsync","waitForTypeScriptAsync","_watchEnvironmentVariables","watchEnvironmentVariables","_startHeadlessAsync","_this","port","CommandError","server","close","addListener","location","host","url","protocol","messageSocket","broadcast","_x2","_postStartAsync","hostType","env","EXPO_OFFLINE","_startTunnelAsync","startDevSessionAsync","watchConfig","_x3","ref","stopObserving","FileNotifier","getConfigModuleIds","startObserving","_startTunnelAsync2","getInstance","AsyncNgrok","_startDevSessionAsync","_this2","ref1","stopNotifying","DevelopmentSession","getNativeRuntimeUrl","getDevServerUrl","closeAsync","catch","error","message","runtime","isTargetingWeb","web","broadcastMessage","method","params","_stopAsync","_this3","ref4","ref2","ref3","exception","resolveWithTimeout","Promise","resolve","reject","timeout","errorMessage","UrlCreator","getTunnelUrl","opts","constructDevClientUrl","scheme","_url","getJsInspectorBaseUrl","ref5","getActiveUrl","_openPlatformAsync","launchTarget","resolver","serverUrl","openBrowserAsync","manager","getPlatformManagerAsync","openAsync","openPlatformAsync","_x4","_openCustomRuntimeAsync","launchProps","props","openCustomRuntimeAsync","_x5","getExpoGoUrl","isRedirectPageEnabled","EXPO_NO_REDIRECT_PAGE","silent","getRedirectUrl","platform","constructLoadingUrl","getReactDevToolsUrl","URL","toString","_getPlatformManagerAsync","Manager","getCustomRuntimeUrl","_x6"],"sources":["C:\\Users\\CR Laptop\\Desktop\\rn-project\\react_navigation\\node_modules\\@expo\\cli\\src\\start\\server\\BundlerDevServer.ts"],"sourcesContent":["import { MessageSocket } from '@expo/dev-server';\nimport assert from 'assert';\nimport resolveFrom from 'resolve-from';\n\nimport * as Log from '../../log';\nimport { FileNotifier } from '../../utils/FileNotifier';\nimport { resolveWithTimeout } from '../../utils/delay';\nimport { env } from '../../utils/env';\nimport { CommandError } from '../../utils/errors';\nimport { openBrowserAsync } from '../../utils/open';\nimport {\n  BaseOpenInCustomProps,\n  BaseResolveDeviceProps,\n  PlatformManager,\n} from '../platforms/PlatformManager';\nimport { AsyncNgrok } from './AsyncNgrok';\nimport { DevelopmentSession } from './DevelopmentSession';\nimport { CreateURLOptions, UrlCreator } from './UrlCreator';\nimport { PlatformBundlers } from './platformBundlers';\n\nconst debug = require('debug')('expo:start:server:devServer') as typeof console.log;\n\nexport type ServerLike = {\n  close(callback?: (err?: Error) => void): void;\n  addListener?(event: string, listener: (...args: any[]) => void): unknown;\n};\n\nexport type DevServerInstance = {\n  /** Bundler dev server instance. */\n  server: ServerLike;\n  /** Dev server URL location properties. */\n  location: {\n    url: string;\n    port: number;\n    protocol: 'http' | 'https';\n    host?: string;\n  };\n  /** Additional middleware that's attached to the `server`. */\n  middleware: any;\n  /** Message socket for communicating with the runtime. */\n  messageSocket: MessageSocket;\n};\n\nexport interface BundlerStartOptions {\n  /** Should the dev server use `https` protocol. */\n  https?: boolean;\n  /** Should start the dev servers in development mode (minify). */\n  mode?: 'development' | 'production';\n  /** Is dev client enabled. */\n  devClient?: boolean;\n  /** Should run dev servers with clean caches. */\n  resetDevServer?: boolean;\n  /** Which manifest type to serve. */\n  forceManifestType?: 'expo-updates' | 'classic';\n  /** Code signing private key path (defaults to same directory as certificate) */\n  privateKeyPath?: string;\n\n  /** Max amount of workers (threads) to use with Metro bundler, defaults to undefined for max workers. */\n  maxWorkers?: number;\n  /** Port to start the dev server on. */\n  port?: number;\n\n  /** Should start a headless dev server e.g. mock representation to approximate info from a server running in a different process. */\n  headless?: boolean;\n  /** Should instruct the bundler to create minified bundles. */\n  minify?: boolean;\n\n  // Webpack options\n  /** Should modify and create PWA icons. */\n  isImageEditingEnabled?: boolean;\n\n  location: CreateURLOptions;\n}\n\nconst PLATFORM_MANAGERS = {\n  simulator: () =>\n    require('../platforms/ios/ApplePlatformManager')\n      .ApplePlatformManager as typeof import('../platforms/ios/ApplePlatformManager').ApplePlatformManager,\n  emulator: () =>\n    require('../platforms/android/AndroidPlatformManager')\n      .AndroidPlatformManager as typeof import('../platforms/android/AndroidPlatformManager').AndroidPlatformManager,\n};\n\nconst MIDDLEWARES = {\n  classic: () =>\n    require('./middleware/ClassicManifestMiddleware')\n      .ClassicManifestMiddleware as typeof import('./middleware/ClassicManifestMiddleware').ClassicManifestMiddleware,\n  'expo-updates': () =>\n    require('./middleware/ExpoGoManifestHandlerMiddleware')\n      .ExpoGoManifestHandlerMiddleware as typeof import('./middleware/ExpoGoManifestHandlerMiddleware').ExpoGoManifestHandlerMiddleware,\n};\n\nexport abstract class BundlerDevServer {\n  /** Name of the bundler. */\n  abstract get name(): string;\n\n  /** Ngrok instance for managing tunnel connections. */\n  protected ngrok: AsyncNgrok | null = null;\n  /** Interfaces with the Expo 'Development Session' API. */\n  protected devSession: DevelopmentSession | null = null;\n  /** Http server and related info. */\n  protected instance: DevServerInstance | null = null;\n  /** Native platform interfaces for opening projects.  */\n  private platformManagers: Record<string, PlatformManager<any>> = {};\n  /** Manages the creation of dev server URLs. */\n  protected urlCreator?: UrlCreator | null = null;\n\n  private notifier: FileNotifier | null = null;\n\n  constructor(\n    /** Project root folder. */\n    public projectRoot: string,\n    /** A mapping of bundlers to platforms. */\n    public platformBundlers: PlatformBundlers,\n    // TODO: Replace with custom scheme maybe...\n    public isDevClient?: boolean\n  ) {}\n\n  protected setInstance(instance: DevServerInstance) {\n    this.instance = instance;\n  }\n\n  /** Get the manifest middleware function. */\n  protected async getManifestMiddlewareAsync(\n    options: Pick<\n      BundlerStartOptions,\n      'minify' | 'mode' | 'forceManifestType' | 'privateKeyPath'\n    > = {}\n  ) {\n    const manifestType = options.forceManifestType || 'classic';\n    assert(manifestType in MIDDLEWARES, `Manifest middleware for type '${manifestType}' not found`);\n    const Middleware = MIDDLEWARES[manifestType]();\n\n    const urlCreator = this.getUrlCreator();\n    const middleware = new Middleware(this.projectRoot, {\n      constructUrl: urlCreator.constructUrl.bind(urlCreator),\n      mode: options.mode,\n      minify: options.minify,\n      isNativeWebpack: this.name === 'webpack' && this.isTargetingNative(),\n      privateKeyPath: options.privateKeyPath,\n    });\n    return middleware;\n  }\n\n  /** Start the dev server using settings defined in the start command. */\n  public async startAsync(options: BundlerStartOptions): Promise<DevServerInstance> {\n    await this.stopAsync();\n\n    let instance: DevServerInstance;\n    if (options.headless) {\n      instance = await this.startHeadlessAsync(options);\n    } else {\n      instance = await this.startImplementationAsync(options);\n    }\n\n    this.setInstance(instance);\n    await this.postStartAsync(options);\n    return instance;\n  }\n\n  protected abstract startImplementationAsync(\n    options: BundlerStartOptions\n  ): Promise<DevServerInstance>;\n\n  public async waitForTypeScriptAsync(): Promise<boolean> {\n    return false;\n  }\n\n  public abstract startTypeScriptServices(): Promise<void>;\n\n  public async watchEnvironmentVariables(): Promise<void> {\n    // noop -- We've only implemented this functionality in Metro.\n  }\n\n  /**\n   * Creates a mock server representation that can be used to estimate URLs for a server started in another process.\n   * This is used for the run commands where you can reuse the server from a previous run.\n   */\n  private async startHeadlessAsync(options: BundlerStartOptions): Promise<DevServerInstance> {\n    if (!options.port)\n      throw new CommandError('HEADLESS_SERVER', 'headless dev server requires a port option');\n    this.urlCreator = this.getUrlCreator(options);\n\n    return {\n      // Create a mock server\n      server: {\n        close: () => {\n          this.instance = null;\n        },\n        addListener() {},\n      },\n      location: {\n        // The port is the main thing we want to send back.\n        port: options.port,\n        // localhost isn't always correct.\n        host: 'localhost',\n        // http is the only supported protocol on native.\n        url: `http://localhost:${options.port}`,\n        protocol: 'http',\n      },\n      middleware: {},\n      messageSocket: {\n        broadcast: () => {\n          throw new CommandError('HEADLESS_SERVER', 'Cannot broadcast messages to headless server');\n        },\n      },\n    };\n  }\n\n  /**\n   * Runs after the `startAsync` function, performing any additional common operations.\n   * You can assume the dev server is started by the time this function is called.\n   */\n  protected async postStartAsync(options: BundlerStartOptions) {\n    if (\n      options.location.hostType === 'tunnel' &&\n      !env.EXPO_OFFLINE &&\n      // This is a hack to prevent using tunnel on web since we block it upstream for some reason.\n      this.isTargetingNative()\n    ) {\n      await this._startTunnelAsync();\n    }\n    await this.startDevSessionAsync();\n\n    this.watchConfig();\n  }\n\n  protected abstract getConfigModuleIds(): string[];\n\n  protected watchConfig() {\n    this.notifier?.stopObserving();\n    this.notifier = new FileNotifier(this.projectRoot, this.getConfigModuleIds());\n    this.notifier.startObserving();\n  }\n\n  /** Create ngrok instance and start the tunnel server. Exposed for testing. */\n  public async _startTunnelAsync(): Promise<AsyncNgrok | null> {\n    const port = this.getInstance()?.location.port;\n    if (!port) return null;\n    debug('[ngrok] connect to port: ' + port);\n    this.ngrok = new AsyncNgrok(this.projectRoot, port);\n    await this.ngrok.startAsync();\n    return this.ngrok;\n  }\n\n  protected async startDevSessionAsync() {\n    // This is used to make Expo Go open the project in either Expo Go, or the web browser.\n    // Must come after ngrok (`startTunnelAsync`) setup.\n    this.devSession?.stopNotifying?.();\n    this.devSession = new DevelopmentSession(\n      this.projectRoot,\n      // This URL will be used on external devices so the computer IP won't be relevant.\n      this.isTargetingNative()\n        ? this.getNativeRuntimeUrl()\n        : this.getDevServerUrl({ hostType: 'localhost' }),\n      () => {\n        // TODO: This appears to be happening consistently after an hour.\n        // We should investigate why this is happening and fix it on our servers.\n        // Log.error(\n        //   chalk.red(\n        //     '\\nAn unexpected error occurred while updating the Dev Session API. This project will not appear in the \"Development servers\" section of the Expo Go app until this process has been restarted.'\n        //   )\n        // );\n        // Log.exception(error);\n        this.devSession?.closeAsync().catch((error) => {\n          debug('[dev-session] error closing: ' + error.message);\n        });\n      }\n    );\n\n    await this.devSession.startAsync({\n      runtime: this.isTargetingNative() ? 'native' : 'web',\n    });\n  }\n\n  public isTargetingNative() {\n    // Temporary hack while we implement multi-bundler dev server proxy.\n    return true;\n  }\n\n  public isTargetingWeb() {\n    return this.platformBundlers.web === this.name;\n  }\n\n  /**\n   * Sends a message over web sockets to any connected device,\n   * does nothing when the dev server is not running.\n   *\n   * @param method name of the command. In RN projects `reload`, and `devMenu` are available. In Expo Go, `sendDevCommand` is available.\n   * @param params\n   */\n  public broadcastMessage(\n    method: 'reload' | 'devMenu' | 'sendDevCommand',\n    params?: Record<string, any>\n  ) {\n    this.getInstance()?.messageSocket.broadcast(method, params);\n  }\n\n  /** Get the running dev server instance. */\n  public getInstance() {\n    return this.instance;\n  }\n\n  /** Stop the running dev server instance. */\n  async stopAsync() {\n    // Stop file watching.\n    this.notifier?.stopObserving();\n\n    // Stop the dev session timer and tell Expo API to remove dev session.\n    await this.devSession?.closeAsync();\n\n    // Stop ngrok if running.\n    await this.ngrok?.stopAsync().catch((e) => {\n      Log.error(`Error stopping ngrok:`);\n      Log.exception(e);\n    });\n\n    return resolveWithTimeout(\n      () =>\n        new Promise<void>((resolve, reject) => {\n          // Close the server.\n          debug(`Stopping dev server (bundler: ${this.name})`);\n\n          if (this.instance?.server) {\n            this.instance.server.close((error) => {\n              debug(`Stopped dev server (bundler: ${this.name})`);\n              this.instance = null;\n              if (error) {\n                reject(error);\n              } else {\n                resolve();\n              }\n            });\n          } else {\n            debug(`Stopped dev server (bundler: ${this.name})`);\n            this.instance = null;\n            resolve();\n          }\n        }),\n      {\n        // NOTE(Bacon): Metro dev server doesn't seem to be closing in time.\n        timeout: 1000,\n        errorMessage: `Timeout waiting for '${this.name}' dev server to close`,\n      }\n    );\n  }\n\n  public getUrlCreator(options: Partial<Pick<BundlerStartOptions, 'port' | 'location'>> = {}) {\n    if (!this.urlCreator) {\n      assert(options?.port, 'Dev server instance not found');\n      this.urlCreator = new UrlCreator(options.location, {\n        port: options.port,\n        getTunnelUrl: this.getTunnelUrl.bind(this),\n      });\n    }\n    return this.urlCreator;\n  }\n\n  public getNativeRuntimeUrl(opts: Partial<CreateURLOptions> = {}) {\n    return this.isDevClient\n      ? this.getUrlCreator().constructDevClientUrl(opts) ?? this.getDevServerUrl()\n      : this.getUrlCreator().constructUrl({ ...opts, scheme: 'exp' });\n  }\n\n  /** Get the URL for the running instance of the dev server. */\n  public getDevServerUrl(options: { hostType?: 'localhost' } = {}): string | null {\n    const instance = this.getInstance();\n    if (!instance?.location) {\n      return null;\n    }\n    const { location } = instance;\n    if (options.hostType === 'localhost') {\n      return `${location.protocol}://localhost:${location.port}`;\n    }\n    return location.url ?? null;\n  }\n\n  /** Get the base URL for JS inspector */\n  public getJsInspectorBaseUrl(): string {\n    if (this.name !== 'metro') {\n      throw new CommandError(\n        'DEV_SERVER',\n        `Cannot get the JS inspector base url - bundler[${this.name}]`\n      );\n    }\n    return this.getUrlCreator().constructUrl({ scheme: 'http' });\n  }\n\n  /** Get the tunnel URL from ngrok. */\n  public getTunnelUrl(): string | null {\n    return this.ngrok?.getActiveUrl() ?? null;\n  }\n\n  /** Open the dev server in a runtime. */\n  public async openPlatformAsync(\n    launchTarget: keyof typeof PLATFORM_MANAGERS | 'desktop',\n    resolver: BaseResolveDeviceProps<any> = {}\n  ) {\n    if (launchTarget === 'desktop') {\n      const serverUrl = this.getDevServerUrl({ hostType: 'localhost' });\n      // Allow opening the tunnel URL when using Metro web.\n      const url = this.name === 'metro' ? this.getTunnelUrl() ?? serverUrl : serverUrl;\n      await openBrowserAsync(url!);\n      return { url };\n    }\n\n    const runtime = this.isTargetingNative() ? (this.isDevClient ? 'custom' : 'expo') : 'web';\n    const manager = await this.getPlatformManagerAsync(launchTarget);\n    return manager.openAsync({ runtime }, resolver);\n  }\n\n  /** Open the dev server in a runtime. */\n  public async openCustomRuntimeAsync(\n    launchTarget: keyof typeof PLATFORM_MANAGERS,\n    launchProps: Partial<BaseOpenInCustomProps> = {},\n    resolver: BaseResolveDeviceProps<any> = {}\n  ) {\n    const runtime = this.isTargetingNative() ? (this.isDevClient ? 'custom' : 'expo') : 'web';\n    if (runtime !== 'custom') {\n      throw new CommandError(\n        `dev server cannot open custom runtimes either because it does not target native platforms or because it is not targeting dev clients. (target: ${runtime})`\n      );\n    }\n\n    const manager = await this.getPlatformManagerAsync(launchTarget);\n    return manager.openAsync({ runtime: 'custom', props: launchProps }, resolver);\n  }\n\n  /** Get the URL for opening in Expo Go. */\n  protected getExpoGoUrl(): string {\n    return this.getUrlCreator().constructUrl({ scheme: 'exp' });\n  }\n\n  /** Should use the interstitial page for selecting which runtime to use. */\n  protected isRedirectPageEnabled(): boolean {\n    return (\n      !env.EXPO_NO_REDIRECT_PAGE &&\n      // if user passed --dev-client flag, skip interstitial page\n      !this.isDevClient &&\n      // Checks if dev client is installed.\n      !!resolveFrom.silent(this.projectRoot, 'expo-dev-client')\n    );\n  }\n\n  /** Get the redirect URL when redirecting is enabled. */\n  public getRedirectUrl(platform: keyof typeof PLATFORM_MANAGERS | null = null): string | null {\n    if (!this.isRedirectPageEnabled()) {\n      debug('Redirect page is disabled');\n      return null;\n    }\n\n    return (\n      this.getUrlCreator().constructLoadingUrl(\n        {},\n        platform === 'emulator' ? 'android' : platform === 'simulator' ? 'ios' : null\n      ) ?? null\n    );\n  }\n\n  public getReactDevToolsUrl(): string {\n    return new URL(\n      '_expo/react-devtools',\n      this.getUrlCreator().constructUrl({ scheme: 'http' })\n    ).toString();\n  }\n\n  protected async getPlatformManagerAsync(platform: keyof typeof PLATFORM_MANAGERS) {\n    if (!this.platformManagers[platform]) {\n      const Manager = PLATFORM_MANAGERS[platform]();\n      const port = this.getInstance()?.location.port;\n      if (!port || !this.urlCreator) {\n        throw new CommandError(\n          'DEV_SERVER',\n          'Cannot interact with native platforms until dev server has started'\n        );\n      }\n      debug(`Creating platform manager (platform: ${platform}, port: ${port})`);\n      this.platformManagers[platform] = new Manager(this.projectRoot, port, {\n        getCustomRuntimeUrl: this.urlCreator.constructDevClientUrl.bind(this.urlCreator),\n        getExpoGoUrl: this.getExpoGoUrl.bind(this),\n        getRedirectUrl: this.getRedirectUrl.bind(this, platform),\n        getDevServerUrl: this.getDevServerUrl.bind(this, { hostType: 'localhost' }),\n      });\n    }\n    return this.platformManagers[platform];\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}