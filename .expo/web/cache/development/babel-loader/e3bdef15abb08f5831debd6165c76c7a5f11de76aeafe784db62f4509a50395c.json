{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _inherits = require(\"@babel/runtime/helpers/inherits\");\nvar _possibleConstructorReturn = require(\"@babel/runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"@babel/runtime/helpers/getPrototypeOf\");\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar _url = require(\"url\");\nvar Log = _interopRequireWildcard(require(\"../../../log\"));\nvar _expoMiddleware = require(\"./ExpoMiddleware\");\nvar _resolvePlatform = require(\"./resolvePlatform\");\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n          if (desc.get || desc.set) {\n            Object.defineProperty(newObj, key, desc);\n          } else {\n            newObj[key] = obj[key];\n          }\n        }\n      }\n    }\n    newObj.default = obj;\n    return newObj;\n  }\n}\nvar debug = require(\"debug\")(\"expo:start:server:middleware:runtimeRedirect\");\nvar RuntimeRedirectMiddleware = function (_expoMiddleware$ExpoM) {\n  _inherits(RuntimeRedirectMiddleware, _expoMiddleware$ExpoM);\n  var _super = _createSuper(RuntimeRedirectMiddleware);\n  function RuntimeRedirectMiddleware(projectRoot, options) {\n    var _this;\n    _classCallCheck(this, RuntimeRedirectMiddleware);\n    _this = _super.call(this, projectRoot, [\"/_expo/link\"]);\n    _this.projectRoot = projectRoot;\n    _this.options = options;\n    return _this;\n  }\n  _createClass(RuntimeRedirectMiddleware, [{\n    key: \"handleRequestAsync\",\n    value: function () {\n      var _handleRequestAsync = _asyncToGenerator(function* (req, res) {\n        var _parse = (0, _url).parse(req.url, true),\n          query = _parse.query;\n        var isDevClient = query[\"choice\"] === \"expo-dev-client\";\n        var ref;\n        var platform = (ref = (0, _resolvePlatform).parsePlatformHeader(req)) != null ? ref : (0, _resolvePlatform).resolvePlatformFromUserAgentHeader(req);\n        (0, _resolvePlatform).assertMissingRuntimePlatform(platform);\n        (0, _resolvePlatform).assertRuntimePlatform(platform);\n        var runtime = isDevClient ? \"custom\" : \"expo\";\n        debug(`props:`, {\n          platform: platform,\n          runtime: runtime\n        });\n        this.options.onDeepLink({\n          runtime: runtime,\n          platform: platform\n        });\n        var redirect = this.options.getLocation({\n          runtime: runtime\n        });\n        if (!redirect) {\n          Log.warn(`[redirect middleware]: Unable to determine redirect location for runtime '${runtime}' and platform '${platform}'`);\n          res.statusCode = 404;\n          res.end();\n          return;\n        }\n        debug(\"Redirect ->\", redirect);\n        res.setHeader(\"Location\", redirect);\n        (0, _expoMiddleware).disableResponseCache(res);\n        res.statusCode = 307;\n        res.end();\n      });\n      function handleRequestAsync(_x, _x2) {\n        return _handleRequestAsync.apply(this, arguments);\n      }\n      return handleRequestAsync;\n    }()\n  }]);\n  return RuntimeRedirectMiddleware;\n}(_expoMiddleware.ExpoMiddleware);\nexports.RuntimeRedirectMiddleware = RuntimeRedirectMiddleware;","map":{"version":3,"names":["_asyncToGenerator","require","_classCallCheck","_createClass","_inherits","_possibleConstructorReturn","_getPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Boolean","prototype","valueOf","call","e","_url","Log","_interopRequireWildcard","_expoMiddleware","_resolvePlatform","debug","RuntimeRedirectMiddleware","_expoMiddleware$ExpoM","_super","projectRoot","options","_this","key","value","_handleRequestAsync","req","res","_parse","parse","url","query","isDevClient","ref","platform","parsePlatformHeader","resolvePlatformFromUserAgentHeader","assertMissingRuntimePlatform","assertRuntimePlatform","runtime","onDeepLink","redirect","getLocation","warn","statusCode","end","setHeader","disableResponseCache","handleRequestAsync","_x","_x2","ExpoMiddleware"],"sources":["C:\\Users\\CR Laptop\\Desktop\\rn-project\\react_navigation\\node_modules\\@expo\\cli\\src\\start\\server\\middleware\\RuntimeRedirectMiddleware.ts"],"sourcesContent":["import { parse } from 'url';\n\nimport * as Log from '../../../log';\nimport { disableResponseCache, ExpoMiddleware } from './ExpoMiddleware';\nimport {\n  assertMissingRuntimePlatform,\n  assertRuntimePlatform,\n  parsePlatformHeader,\n  resolvePlatformFromUserAgentHeader,\n  RuntimePlatform,\n} from './resolvePlatform';\nimport { ServerRequest, ServerResponse } from './server.types';\n\nconst debug = require('debug')(\n  'expo:start:server:middleware:runtimeRedirect'\n) as typeof console.log;\n\n/** Runtime to target: expo = Expo Go, custom = Dev Client. */\ntype RuntimeTarget = 'expo' | 'custom';\n\nexport type DeepLinkHandler = (props: {\n  runtime: RuntimeTarget;\n  platform: RuntimePlatform;\n}) => void | Promise<void>;\n\nexport class RuntimeRedirectMiddleware extends ExpoMiddleware {\n  constructor(\n    protected projectRoot: string,\n    protected options: {\n      onDeepLink: DeepLinkHandler;\n      getLocation: (props: { runtime: RuntimeTarget }) => string | null | undefined;\n    }\n  ) {\n    super(projectRoot, ['/_expo/link']);\n  }\n\n  async handleRequestAsync(req: ServerRequest, res: ServerResponse): Promise<void> {\n    const { query } = parse(req.url!, true);\n    const isDevClient = query['choice'] === 'expo-dev-client';\n    const platform = parsePlatformHeader(req) ?? resolvePlatformFromUserAgentHeader(req);\n    assertMissingRuntimePlatform(platform);\n    assertRuntimePlatform(platform);\n    const runtime = isDevClient ? 'custom' : 'expo';\n\n    debug(`props:`, { platform, runtime });\n\n    this.options.onDeepLink({ runtime, platform });\n\n    const redirect = this.options.getLocation({ runtime });\n    if (!redirect) {\n      Log.warn(\n        `[redirect middleware]: Unable to determine redirect location for runtime '${runtime}' and platform '${platform}'`\n      );\n      res.statusCode = 404;\n      res.end();\n      return;\n    }\n    debug('Redirect ->', redirect);\n    res.setHeader('Location', redirect);\n\n    // Disable caching\n    disableResponseCache(res);\n\n    // 'Temporary Redirect'\n    res.statusCode = 307;\n    res.end();\n  }\n}\n"],"mappings":"AAAA;;AAAA,IAAAA,iBAAA,GAAAC,OAAA;AAAA,IAAAC,eAAA,GAAAD,OAAA;AAAA,IAAAE,YAAA,GAAAF,OAAA;AAAA,IAAAG,SAAA,GAAAH,OAAA;AAAA,IAAAI,0BAAA,GAAAJ,OAAA;AAAA,IAAAK,eAAA,GAAAL,OAAA;AAAA,SAAAM,aAAAC,OAAA,QAAAC,yBAAA,GAAAC,yBAAA,oBAAAC,qBAAA,QAAAC,KAAA,GAAAN,eAAA,CAAAE,OAAA,GAAAK,MAAA,MAAAJ,yBAAA,QAAAK,SAAA,GAAAR,eAAA,OAAAS,WAAA,EAAAF,MAAA,GAAAG,OAAA,CAAAC,SAAA,CAAAL,KAAA,EAAAM,SAAA,EAAAJ,SAAA,YAAAD,MAAA,GAAAD,KAAA,CAAAO,KAAA,OAAAD,SAAA,YAAAb,0BAAA,OAAAQ,MAAA;AAAA,SAAAH,0BAAA,eAAAM,OAAA,qBAAAA,OAAA,CAAAC,SAAA,oBAAAD,OAAA,CAAAC,SAAA,CAAAG,IAAA,2BAAAC,KAAA,oCAAAC,OAAA,CAAAC,SAAA,CAAAC,OAAA,CAAAC,IAAA,CAAAT,OAAA,CAAAC,SAAA,CAAAK,OAAA,8CAAAI,CAAA;;;;AAAsB,IAAAC,IAAK,GAAA1B,OAAA,CAAL,KAAK;AAEf,IAAA2B,GAAG,GAAAC,uBAAA,CAAA5B,OAAA,eAAoB,EAApB;AACsC,IAAA6B,eAAkB,GAAA7B,OAAA;AAOhE,IAAA8B,gBAAmB,GAAA9B,OAAA;;;;;;;;;;;;;;;;;;;;;;AAG1B,IAAM+B,KAAK,GAAG/B,OAAO,CAAC,OAAO,CAAC,CAC5B,8CAA8C,CAC/C;AAAuB,IAUXgC,yBAAyB,aAAAC,qBAAA;EAAA9B,SAAA,CAAA6B,yBAAA,EAAAC,qBAAA;EAAA,IAAAC,MAAA,GAAA5B,YAAA,CAAA0B,yBAAA;EACpC,SAAAA,0BACYG,WAAmB,EACnBC,OAGT,EACD;IAAA,IAAAC,KAAA;IAAApC,eAAA,OAAA+B,yBAAA;IACAK,KAAA,GAAAH,MAAA,CAAAV,IAAA,OAAMW,WAAW,EAAE,CAAC,aAAa,CAAC;UANxBA,WAAmB,GAAnBA,WAAmB;UACnBC,OAGT,GAHSA,OAGT;IAAA,OAAAC,KAAA;;EAGFnC,YAAA,CAAA8B,yBAAA;IAAAM,GAAA;IAAAC,KAAA;MAAA,IAAAC,mBAAA,GAAAzC,iBAAA,CAED,WAAyB0C,GAAkB,EAAEC,GAAmB,EAAiB;QAC/E,IAAAC,MAAA,GAAkB,IAAAjB,IAAK,EAAgBkB,KAAhB,CAACH,GAAG,CAACI,GAAG,EAAG,IAAI,CAAC;UAA/BC,KAAK,GAAAH,MAAA,CAALG,KAAK;QACb,IAAMC,WAAW,GAAGD,KAAK,CAAC,QAAQ,CAAC,KAAK,iBAAiB;YACxCE,GAAwB;QAAzC,IAAMC,QAAQ,GAAG,CAAAD,GAAwB,GAAxB,IAAAlB,gBAAmB,EAAKoB,mBAAL,CAACT,GAAG,CAAC,YAAxBO,GAAwB,GAAI,IAAAlB,gBAAkC,EAAKqB,kCAAL,CAACV,GAAG,CAAC;QACpF,IAAAX,gBAA4B,EAAUsB,4BAAV,CAACH,QAAQ,CAAC;QACtC,IAAAnB,gBAAqB,EAAUuB,qBAAV,CAACJ,QAAQ,CAAC;QAC/B,IAAMK,OAAO,GAAGP,WAAW,GAAG,QAAQ,GAAG,MAAM;QAE/ChB,KAAK,CAAE,QAAO,EAAE;UAAEkB,QAAQ,EAARA,QAAQ;UAAEK,OAAO,EAAPA;SAAS,CAAC;QAEtC,IAAI,CAAClB,OAAO,CAACmB,UAAU,CAAC;UAAED,OAAO,EAAPA,OAAO;UAAEL,QAAQ,EAARA;SAAU,CAAC;QAE9C,IAAMO,QAAQ,GAAG,IAAI,CAACpB,OAAO,CAACqB,WAAW,CAAC;UAAEH,OAAO,EAAPA;SAAS,CAAC;QACtD,IAAI,CAACE,QAAQ,EAAE;UACb7B,GAAG,CAAC+B,IAAI,CACL,6EAA4EJ,OAAQ,mBAAkBL,QAAS,GAAE,CACnH;UACDP,GAAG,CAACiB,UAAU,GAAG,GAAG;UACpBjB,GAAG,CAACkB,GAAG,EAAE;UACT;;QAEF7B,KAAK,CAAC,aAAa,EAAEyB,QAAQ,CAAC;QAC9Bd,GAAG,CAACmB,SAAS,CAAC,UAAU,EAAEL,QAAQ,CAAC;QAGnC,IAAA3B,eAAoB,EAAKiC,oBAAL,CAACpB,GAAG,CAAC;QAGzBA,GAAG,CAACiB,UAAU,GAAG,GAAG;QACpBjB,GAAG,CAACkB,GAAG,EAAE;OACV;MAAA,SAAAG,mBAAAC,EAAA,EAAAC,GAAA;QAAA,OAAAzB,mBAAA,CAAAtB,KAAA,OAAAD,SAAA;MAAA;MAAA,OAAA8C,kBAAA;IAAA;EAAA;EAAA,OAAA/B,yBAAA;AAAA,EAzC4CH,eAAc,CAAAqC,cAAA;QAAhDlC,yBAAyB,GAAzBA,yBAAyB"},"metadata":{},"sourceType":"script","externalDependencies":[]}