{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"@babel/runtime/helpers/defineProperty\");\nvar _get = require(\"@babel/runtime/helpers/get\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _inherits = require(\"@babel/runtime/helpers/inherits\");\nvar _possibleConstructorReturn = require(\"@babel/runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"@babel/runtime/helpers/getPrototypeOf\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.USBMUXD_HEADER_SIZE = void 0;\nvar _plist = _interopRequireDefault(require(\"@expo/plist\"));\nvar _debug = _interopRequireDefault(require(\"debug\"));\nvar _abstractProtocol = require(\"./AbstractProtocol\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nvar debug = (0, _debug).default(\"expo:apple-device:protocol:usbmux\");\nvar USBMUXD_HEADER_SIZE = 16;\nexports.USBMUXD_HEADER_SIZE = USBMUXD_HEADER_SIZE;\nvar UsbmuxProtocolClient = function (_abstractProtocol$Pro) {\n  _inherits(UsbmuxProtocolClient, _abstractProtocol$Pro);\n  var _super = _createSuper(UsbmuxProtocolClient);\n  function UsbmuxProtocolClient(socket) {\n    _classCallCheck(this, UsbmuxProtocolClient);\n    return _super.call(this, socket, new _abstractProtocol.ProtocolReaderFactory(UsbmuxProtocolReader), new UsbmuxProtocolWriter());\n  }\n  return _createClass(UsbmuxProtocolClient);\n}(_abstractProtocol.ProtocolClient);\nexports.UsbmuxProtocolClient = UsbmuxProtocolClient;\nvar UsbmuxProtocolReader = function (_abstractProtocol$Pli) {\n  _inherits(UsbmuxProtocolReader, _abstractProtocol$Pli);\n  var _super2 = _createSuper(UsbmuxProtocolReader);\n  function UsbmuxProtocolReader(callback) {\n    _classCallCheck(this, UsbmuxProtocolReader);\n    return _super2.call(this, USBMUXD_HEADER_SIZE, callback);\n  }\n  _createClass(UsbmuxProtocolReader, [{\n    key: \"parseHeader\",\n    value: function parseHeader(data) {\n      return data.readUInt32LE(0) - USBMUXD_HEADER_SIZE;\n    }\n  }, {\n    key: \"parseBody\",\n    value: function parseBody(data) {\n      var resp = _get(_getPrototypeOf(UsbmuxProtocolReader.prototype), \"parseBody\", this).call(this, data);\n      debug(`Response: ${JSON.stringify(resp)}`);\n      return resp;\n    }\n  }]);\n  return UsbmuxProtocolReader;\n}(_abstractProtocol.PlistProtocolReader);\nexports.UsbmuxProtocolReader = UsbmuxProtocolReader;\nvar UsbmuxProtocolWriter = function () {\n  function UsbmuxProtocolWriter() {\n    _classCallCheck(this, UsbmuxProtocolWriter);\n    this.useTag = 0;\n  }\n  _createClass(UsbmuxProtocolWriter, [{\n    key: \"write\",\n    value: function write(socket, msg) {\n      debug(`socket write: ${JSON.stringify(msg)}`);\n      var messageType = msg.messageType,\n        extraFields = msg.extraFields;\n      var plistMessage = _plist.default.build(_objectSpread({\n        BundleID: \"dev.expo.native-run\",\n        ClientVersionString: \"usbmux.js\",\n        MessageType: messageType,\n        ProgName: \"native-run\",\n        kLibUSBMuxVersion: 3\n      }, extraFields));\n      var dataSize = plistMessage ? plistMessage.length : 0;\n      var protocolVersion = 1;\n      var messageCode = 8;\n      var header = Buffer.alloc(USBMUXD_HEADER_SIZE);\n      header.writeUInt32LE(USBMUXD_HEADER_SIZE + dataSize, 0);\n      header.writeUInt32LE(protocolVersion, 4);\n      header.writeUInt32LE(messageCode, 8);\n      header.writeUInt32LE(this.useTag++, 12);\n      socket.write(header);\n      socket.write(plistMessage);\n    }\n  }]);\n  return UsbmuxProtocolWriter;\n}();\nexports.UsbmuxProtocolWriter = UsbmuxProtocolWriter;","map":{"version":3,"names":["_defineProperty","require","_get","_createClass","_classCallCheck","_inherits","_possibleConstructorReturn","_getPrototypeOf","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","sham","Proxy","Boolean","prototype","valueOf","call","_plist","_interopRequireDefault","_debug","_abstractProtocol","debug","default","USBMUXD_HEADER_SIZE","UsbmuxProtocolClient","_abstractProtocol$Pro","_super","socket","ProtocolReaderFactory","UsbmuxProtocolReader","UsbmuxProtocolWriter","ProtocolClient","_abstractProtocol$Pli","_super2","callback","key","value","parseHeader","data","readUInt32LE","parseBody","resp","JSON","stringify","PlistProtocolReader","useTag","write","msg","messageType","extraFields","plistMessage","build","BundleID","ClientVersionString","MessageType","ProgName","kLibUSBMuxVersion","dataSize","protocolVersion","messageCode","header","Buffer","alloc","writeUInt32LE"],"sources":["C:\\Users\\CR Laptop\\Desktop\\rn-project\\react_navigation\\node_modules\\@expo\\cli\\src\\run\\ios\\appleDevice\\protocol\\UsbmuxProtocol.ts"],"sourcesContent":["/**\n * Copyright (c) 2021 Expo, Inc.\n * Copyright (c) 2018 Drifty Co.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport plist from '@expo/plist';\nimport Debug from 'debug';\nimport { Socket } from 'net';\n\nimport type { ProtocolWriter } from './AbstractProtocol';\nimport { PlistProtocolReader, ProtocolClient, ProtocolReaderFactory } from './AbstractProtocol';\n\nconst debug = Debug('expo:apple-device:protocol:usbmux');\n\nexport const USBMUXD_HEADER_SIZE = 16;\n\nexport interface UsbmuxMessage {\n  messageType: string;\n  extraFields?: { [key: string]: any };\n}\n\nexport class UsbmuxProtocolClient extends ProtocolClient<UsbmuxMessage> {\n  constructor(socket: Socket) {\n    super(socket, new ProtocolReaderFactory(UsbmuxProtocolReader), new UsbmuxProtocolWriter());\n  }\n}\n\nexport class UsbmuxProtocolReader extends PlistProtocolReader {\n  constructor(callback: (data: any) => any) {\n    super(USBMUXD_HEADER_SIZE, callback);\n  }\n\n  parseHeader(data: Buffer) {\n    return data.readUInt32LE(0) - USBMUXD_HEADER_SIZE;\n  }\n\n  parseBody(data: Buffer) {\n    const resp = super.parseBody(data);\n    debug(`Response: ${JSON.stringify(resp)}`);\n    return resp;\n  }\n}\n\nexport class UsbmuxProtocolWriter implements ProtocolWriter {\n  private useTag = 0;\n\n  write(socket: Socket, msg: UsbmuxMessage) {\n    // TODO Usbmux message type\n    debug(`socket write: ${JSON.stringify(msg)}`);\n    const { messageType, extraFields } = msg;\n    const plistMessage = plist.build({\n      BundleID: 'dev.expo.native-run', // TODO\n      ClientVersionString: 'usbmux.js', // TODO\n      MessageType: messageType,\n      ProgName: 'native-run', // TODO\n      kLibUSBMuxVersion: 3,\n      ...extraFields,\n    });\n\n    const dataSize = plistMessage ? plistMessage.length : 0;\n    const protocolVersion = 1;\n    const messageCode = 8;\n\n    const header = Buffer.alloc(USBMUXD_HEADER_SIZE);\n    header.writeUInt32LE(USBMUXD_HEADER_SIZE + dataSize, 0);\n    header.writeUInt32LE(protocolVersion, 4);\n    header.writeUInt32LE(messageCode, 8);\n    header.writeUInt32LE(this.useTag++, 12); // TODO\n    socket.write(header);\n    socket.write(plistMessage);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}