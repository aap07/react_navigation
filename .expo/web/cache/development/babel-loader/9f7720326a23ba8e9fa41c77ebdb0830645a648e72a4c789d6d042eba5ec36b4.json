{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nvar _toConsumableArray = require(\"@babel/runtime/helpers/toConsumableArray\");\nvar _defineProperty = require(\"@babel/runtime/helpers/defineProperty\");\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _inherits = require(\"@babel/runtime/helpers/inherits\");\nvar _possibleConstructorReturn = require(\"@babel/runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"@babel/runtime/helpers/getPrototypeOf\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NpmPackageManager = void 0;\nvar json_file_1 = __importDefault(require(\"@expo/json-file\"));\nvar npm_package_arg_1 = __importDefault(require(\"npm-package-arg\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar nodeWorkspaces_1 = require(\"../utils/nodeWorkspaces\");\nvar spawn_1 = require(\"../utils/spawn\");\nvar BasePackageManager_1 = require(\"./BasePackageManager\");\nvar NpmPackageManager = function (_BasePackageManager_) {\n  _inherits(NpmPackageManager, _BasePackageManager_);\n  var _super = _createSuper(NpmPackageManager);\n  function NpmPackageManager() {\n    var _this;\n    _classCallCheck(this, NpmPackageManager);\n    _this = _super.apply(this, arguments);\n    _this.name = 'npm';\n    _this.bin = 'npm';\n    _this.lockFile = nodeWorkspaces_1.NPM_LOCK_FILE;\n    return _this;\n  }\n  _createClass(NpmPackageManager, [{\n    key: \"workspaceRoot\",\n    value: function workspaceRoot() {\n      var root = (0, nodeWorkspaces_1.findYarnOrNpmWorkspaceRoot)(this.ensureCwdDefined('workspaceRoot'));\n      if (root) {\n        return new NpmPackageManager(_objectSpread(_objectSpread({}, this.options), {}, {\n          silent: this.silent,\n          log: this.log,\n          cwd: root\n        }));\n      }\n      return null;\n    }\n  }, {\n    key: \"addAsync\",\n    value: function addAsync() {\n      var _this2 = this;\n      var namesOrFlags = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      if (!namesOrFlags.length) {\n        return this.installAsync();\n      }\n      var _this$parsePackageSpe = this.parsePackageSpecs(namesOrFlags),\n        flags = _this$parsePackageSpe.flags,\n        versioned = _this$parsePackageSpe.versioned,\n        unversioned = _this$parsePackageSpe.unversioned;\n      return (0, spawn_1.createPendingSpawnAsync)(function () {\n        return _this2.updatePackageFileAsync(versioned, 'dependencies');\n      }, function () {\n        return !unversioned.length ? _this2.runAsync(['install'].concat(_toConsumableArray(flags))) : _this2.runAsync(['install', '--save'].concat(_toConsumableArray(flags), _toConsumableArray(unversioned.map(function (spec) {\n          return spec.raw;\n        }))));\n      });\n    }\n  }, {\n    key: \"addDevAsync\",\n    value: function addDevAsync() {\n      var _this3 = this;\n      var namesOrFlags = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      if (!namesOrFlags.length) {\n        return this.installAsync();\n      }\n      var _this$parsePackageSpe2 = this.parsePackageSpecs(namesOrFlags),\n        flags = _this$parsePackageSpe2.flags,\n        versioned = _this$parsePackageSpe2.versioned,\n        unversioned = _this$parsePackageSpe2.unversioned;\n      return (0, spawn_1.createPendingSpawnAsync)(function () {\n        return _this3.updatePackageFileAsync(versioned, 'devDependencies');\n      }, function () {\n        return !unversioned.length ? _this3.runAsync(['install'].concat(_toConsumableArray(flags))) : _this3.runAsync(['install', '--save-dev'].concat(_toConsumableArray(flags), _toConsumableArray(unversioned.map(function (spec) {\n          return spec.raw;\n        }))));\n      });\n    }\n  }, {\n    key: \"addGlobalAsync\",\n    value: function addGlobalAsync() {\n      var namesOrFlags = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      if (!namesOrFlags.length) {\n        return this.installAsync();\n      }\n      return this.runAsync(['install', '--global'].concat(_toConsumableArray(namesOrFlags)));\n    }\n  }, {\n    key: \"removeAsync\",\n    value: function removeAsync(namesOrFlags) {\n      return this.runAsync(['uninstall'].concat(_toConsumableArray(namesOrFlags)));\n    }\n  }, {\n    key: \"removeDevAsync\",\n    value: function removeDevAsync(namesOrFlags) {\n      return this.runAsync(['uninstall', '--save-dev'].concat(_toConsumableArray(namesOrFlags)));\n    }\n  }, {\n    key: \"removeGlobalAsync\",\n    value: function removeGlobalAsync(namesOrFlags) {\n      return this.runAsync(['uninstall', '--global'].concat(_toConsumableArray(namesOrFlags)));\n    }\n  }, {\n    key: \"parsePackageSpecs\",\n    value: function parsePackageSpecs(namesOrFlags) {\n      var result = {\n        flags: [],\n        versioned: [],\n        unversioned: []\n      };\n      namesOrFlags.map(function (name) {\n        if (name.trim().startsWith('-')) {\n          result.flags.push(name);\n          return null;\n        }\n        return (0, npm_package_arg_1.default)(name);\n      }).forEach(function (spec) {\n        if (spec && spec.rawSpec && spec.type !== 'tag') {\n          result.versioned.push(spec);\n        } else if (spec) {\n          result.unversioned.push(spec);\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"updatePackageFileAsync\",\n    value: function () {\n      var _updatePackageFileAsync = _asyncToGenerator(function* (packageSpecs, packageType) {\n        var _this$options$cwd;\n        if (!packageSpecs.length) {\n          return;\n        }\n        var pkgPath = path_1.default.join(((_this$options$cwd = this.options.cwd) == null ? void 0 : _this$options$cwd.toString()) || '.', 'package.json');\n        var pkg = yield json_file_1.default.readAsync(pkgPath);\n        packageSpecs.forEach(function (spec) {\n          pkg[packageType] = pkg[packageType] || {};\n          pkg[packageType][spec.name] = spec.rawSpec;\n        });\n        yield json_file_1.default.writeAsync(pkgPath, pkg, {\n          json5: false\n        });\n      });\n      function updatePackageFileAsync(_x, _x2) {\n        return _updatePackageFileAsync.apply(this, arguments);\n      }\n      return updatePackageFileAsync;\n    }()\n  }]);\n  return NpmPackageManager;\n}(BasePackageManager_1.BasePackageManager);\nexports.NpmPackageManager = NpmPackageManager;","map":{"version":3,"names":["json_file_1","__importDefault","require","npm_package_arg_1","path_1","nodeWorkspaces_1","spawn_1","BasePackageManager_1","NpmPackageManager","_BasePackageManager_","_inherits","_super","_createSuper","_this","_classCallCheck","name","bin","lockFile","NPM_LOCK_FILE","_createClass","key","value","workspaceRoot","root","findYarnOrNpmWorkspaceRoot","ensureCwdDefined","_objectSpread","options","silent","log","cwd","addAsync","_this2","namesOrFlags","arguments","length","undefined","installAsync","_this$parsePackageSpe","parsePackageSpecs","flags","versioned","unversioned","createPendingSpawnAsync","updatePackageFileAsync","runAsync","concat","_toConsumableArray","map","spec","raw","addDevAsync","_this3","_this$parsePackageSpe2","addGlobalAsync","removeAsync","removeDevAsync","removeGlobalAsync","result","trim","startsWith","push","default","forEach","rawSpec","type","_updatePackageFileAsync","_asyncToGenerator","packageSpecs","packageType","_this$options$cwd","pkgPath","join","toString","pkg","readAsync","writeAsync","json5","_x","_x2","apply","BasePackageManager","exports"],"sources":["../../src/node/NpmPackageManager.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}