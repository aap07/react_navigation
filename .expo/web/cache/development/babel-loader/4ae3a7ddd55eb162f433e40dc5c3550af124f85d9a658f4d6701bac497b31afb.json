{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _inherits = require(\"@babel/runtime/helpers/inherits\");\nvar _possibleConstructorReturn = require(\"@babel/runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"@babel/runtime/helpers/getPrototypeOf\");\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar _debug = _interopRequireDefault(require(\"debug\"));\nvar fs = _interopRequireWildcard(require(\"fs\"));\nvar _lockdownProtocol = require(\"../protocol/LockdownProtocol\");\nvar _serviceClient = require(\"./ServiceClient\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n          if (desc.get || desc.set) {\n            Object.defineProperty(newObj, key, desc);\n          } else {\n            newObj[key] = obj[key];\n          }\n        }\n      }\n    }\n    newObj.default = obj;\n    return newObj;\n  }\n}\nvar debug = (0, _debug).default(\"expo:apple-device:client:mobile_image_mounter\");\nfunction isMIMUploadCompleteResponse(resp) {\n  return resp.Status === \"Complete\";\n}\nfunction isMIMUploadReceiveBytesResponse(resp) {\n  return resp.Status === \"ReceiveBytesAck\";\n}\nvar MobileImageMounterClient = function (_serviceClient$Servic) {\n  _inherits(MobileImageMounterClient, _serviceClient$Servic);\n  var _super = _createSuper(MobileImageMounterClient);\n  function MobileImageMounterClient(socket) {\n    _classCallCheck(this, MobileImageMounterClient);\n    return _super.call(this, socket, new _lockdownProtocol.LockdownProtocolClient(socket));\n  }\n  _createClass(MobileImageMounterClient, [{\n    key: \"mountImage\",\n    value: function () {\n      var _mountImage = _asyncToGenerator(function* (imagePath, imageSig) {\n        debug(`mountImage: ${imagePath}`);\n        var resp = yield this.protocolClient.sendMessage({\n          Command: \"MountImage\",\n          ImagePath: imagePath,\n          ImageSignature: imageSig,\n          ImageType: \"Developer\"\n        });\n        if (!(0, _lockdownProtocol).isLockdownResponse(resp) || resp.Status !== \"Complete\") {\n          throw new _serviceClient.ResponseError(`There was an error mounting ${imagePath} on device`, resp);\n        }\n      });\n      function mountImage(_x, _x2) {\n        return _mountImage.apply(this, arguments);\n      }\n      return mountImage;\n    }()\n  }, {\n    key: \"uploadImage\",\n    value: function () {\n      var _uploadImage = _asyncToGenerator(function* (imagePath, imageSig) {\n        var _this = this;\n        debug(`uploadImage: ${imagePath}`);\n        var imageSize = fs.statSync(imagePath).size;\n        return this.protocolClient.sendMessage({\n          Command: \"ReceiveBytes\",\n          ImageSize: imageSize,\n          ImageSignature: imageSig,\n          ImageType: \"Developer\"\n        }, function (resp, resolve, reject) {\n          if (isMIMUploadReceiveBytesResponse(resp)) {\n            var imageStream = fs.createReadStream(imagePath);\n            imageStream.pipe(_this.protocolClient.socket, {\n              end: false\n            });\n            imageStream.on(\"error\", function (err) {\n              return reject(err);\n            });\n          } else if (isMIMUploadCompleteResponse(resp)) {\n            resolve();\n          } else {\n            reject(new _serviceClient.ResponseError(`There was an error uploading image ${imagePath} to the device`, resp));\n          }\n        });\n      });\n      function uploadImage(_x3, _x4) {\n        return _uploadImage.apply(this, arguments);\n      }\n      return uploadImage;\n    }()\n  }, {\n    key: \"lookupImage\",\n    value: function () {\n      var _lookupImage = _asyncToGenerator(function* () {\n        debug(\"lookupImage\");\n        return this.protocolClient.sendMessage({\n          Command: \"LookupImage\",\n          ImageType: \"Developer\"\n        });\n      });\n      function lookupImage() {\n        return _lookupImage.apply(this, arguments);\n      }\n      return lookupImage;\n    }()\n  }]);\n  return MobileImageMounterClient;\n}(_serviceClient.ServiceClient);\nexports.MobileImageMounterClient = MobileImageMounterClient;","map":{"version":3,"names":["_asyncToGenerator","require","_classCallCheck","_createClass","_inherits","_possibleConstructorReturn","_getPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","arguments","apply","sham","Proxy","Boolean","prototype","valueOf","call","e","_debug","_interopRequireDefault","fs","_interopRequireWildcard","_lockdownProtocol","_serviceClient","debug","default","isMIMUploadCompleteResponse","resp","Status","isMIMUploadReceiveBytesResponse","MobileImageMounterClient","_serviceClient$Servic","_super","socket","LockdownProtocolClient","key","value","_mountImage","imagePath","imageSig","protocolClient","sendMessage","Command","ImagePath","ImageSignature","ImageType","isLockdownResponse","ResponseError","mountImage","_x","_x2","_uploadImage","_this","imageSize","statSync","size","ImageSize","resolve","reject","imageStream","createReadStream","pipe","end","on","err","uploadImage","_x3","_x4","_lookupImage","lookupImage","ServiceClient"],"sources":["C:\\Users\\CR Laptop\\Desktop\\rn-project\\react_navigation\\node_modules\\@expo\\cli\\src\\run\\ios\\appleDevice\\client\\MobileImageMounterClient.ts"],"sourcesContent":["/**\n * Copyright (c) 2021 Expo, Inc.\n * Copyright (c) 2018 Drifty Co.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport Debug from 'debug';\nimport * as fs from 'fs';\nimport { Socket } from 'net';\n\nimport type { LockdownCommand, LockdownResponse } from '../protocol/LockdownProtocol';\nimport { isLockdownResponse, LockdownProtocolClient } from '../protocol/LockdownProtocol';\nimport { ResponseError, ServiceClient } from './ServiceClient';\n\nconst debug = Debug('expo:apple-device:client:mobile_image_mounter');\n\nexport type MIMMountResponse = LockdownResponse;\n\nexport interface MIMMessage extends LockdownCommand {\n  ImageType: string;\n}\n\nexport interface MIMLookupResponse extends LockdownResponse {\n  ImageSignature?: string;\n}\n\nexport interface MIMUploadCompleteResponse extends LockdownResponse {\n  Status: 'Complete';\n}\n\nexport interface MIMUploadReceiveBytesResponse extends LockdownResponse {\n  Status: 'ReceiveBytesAck';\n}\n\nfunction isMIMUploadCompleteResponse(resp: any): resp is MIMUploadCompleteResponse {\n  return resp.Status === 'Complete';\n}\n\nfunction isMIMUploadReceiveBytesResponse(resp: any): resp is MIMUploadReceiveBytesResponse {\n  return resp.Status === 'ReceiveBytesAck';\n}\n\nexport class MobileImageMounterClient extends ServiceClient<LockdownProtocolClient<MIMMessage>> {\n  constructor(socket: Socket) {\n    super(socket, new LockdownProtocolClient(socket));\n  }\n\n  async mountImage(imagePath: string, imageSig: Buffer) {\n    debug(`mountImage: ${imagePath}`);\n\n    const resp = await this.protocolClient.sendMessage({\n      Command: 'MountImage',\n      ImagePath: imagePath,\n      ImageSignature: imageSig,\n      ImageType: 'Developer',\n    });\n\n    if (!isLockdownResponse(resp) || resp.Status !== 'Complete') {\n      throw new ResponseError(`There was an error mounting ${imagePath} on device`, resp);\n    }\n  }\n\n  async uploadImage(imagePath: string, imageSig: Buffer) {\n    debug(`uploadImage: ${imagePath}`);\n\n    const imageSize = fs.statSync(imagePath).size;\n    return this.protocolClient.sendMessage(\n      {\n        Command: 'ReceiveBytes',\n        ImageSize: imageSize,\n        ImageSignature: imageSig,\n        ImageType: 'Developer',\n      },\n      (resp: any, resolve, reject) => {\n        if (isMIMUploadReceiveBytesResponse(resp)) {\n          const imageStream = fs.createReadStream(imagePath);\n          imageStream.pipe(this.protocolClient.socket, { end: false });\n          imageStream.on('error', (err) => reject(err));\n        } else if (isMIMUploadCompleteResponse(resp)) {\n          resolve();\n        } else {\n          reject(\n            new ResponseError(`There was an error uploading image ${imagePath} to the device`, resp)\n          );\n        }\n      }\n    );\n  }\n\n  async lookupImage() {\n    debug('lookupImage');\n\n    return this.protocolClient.sendMessage<MIMLookupResponse>({\n      Command: 'LookupImage',\n      ImageType: 'Developer',\n    });\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}