{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"@babel/runtime/helpers/defineProperty\");\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.runServer = void 0;\nvar _assert = _interopRequireDefault(require(\"assert\"));\nvar _http = _interopRequireDefault(require(\"http\"));\nvar _https = _interopRequireDefault(require(\"https\"));\nvar _url = require(\"url\");\nvar _env = require(\"../../../utils/env\");\nvar _inspectorProxy = require(\"./inspector-proxy\");\nvar _resolveFromProject = require(\"./resolveFromProject\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nvar runServer = function () {\n  var _ref2 = _asyncToGenerator(function* (metroBundler, config, _ref) {\n    var _ref$hasReducedPerfor = _ref.hasReducedPerformance,\n      hasReducedPerformance = _ref$hasReducedPerfor === void 0 ? false : _ref$hasReducedPerfor,\n      host = _ref.host,\n      onError = _ref.onError,\n      onReady = _ref.onReady,\n      secureServerOptions = _ref.secureServerOptions,\n      _ref$waitForBundler = _ref.waitForBundler,\n      waitForBundler = _ref$waitForBundler === void 0 ? false : _ref$waitForBundler,\n      _ref$websocketEndpoin = _ref.websocketEndpoints,\n      websocketEndpoints = _ref$websocketEndpoin === void 0 ? {} : _ref$websocketEndpoin,\n      watch = _ref.watch;\n    var projectRoot = metroBundler.projectRoot;\n    var Metro = (0, _resolveFromProject).importMetroFromProject(projectRoot);\n    var createWebsocketServer = (0, _resolveFromProject).importMetroCreateWebsocketServerFromProject(projectRoot);\n    var MetroHmrServer = (0, _resolveFromProject).importMetroHmrServerFromProject(projectRoot);\n    var _yield$Metro$createCo = yield Metro.createConnectMiddleware(config, {\n        hasReducedPerformance: hasReducedPerformance,\n        waitForBundler: waitForBundler,\n        watch: watch\n      }),\n      middleware = _yield$Metro$createCo.middleware,\n      end = _yield$Metro$createCo.end,\n      metroServer = _yield$Metro$createCo.metroServer;\n    (0, _assert).default(typeof middleware.use === \"function\");\n    var serverApp = middleware;\n    var inspectorProxy = null;\n    if (config.server.runInspectorProxy && !_env.env.EXPO_NO_INSPECTOR_PROXY) {\n      inspectorProxy = (0, _inspectorProxy).createInspectorProxy(metroBundler, config.projectRoot);\n    } else if (config.server.runInspectorProxy) {\n      var _importMetroInspector = (0, _resolveFromProject).importMetroInspectorProxyFromProject(projectRoot),\n        InspectorProxy = _importMetroInspector.InspectorProxy;\n      inspectorProxy = new InspectorProxy(config.projectRoot);\n    }\n    var httpServer;\n    if (secureServerOptions != null) {\n      httpServer = _https.default.createServer(secureServerOptions, serverApp);\n    } else {\n      httpServer = _http.default.createServer(serverApp);\n    }\n    return new Promise(function (resolve, reject) {\n      httpServer.on(\"error\", function (error) {\n        if (onError) {\n          onError(error);\n        }\n        reject(error);\n        end();\n      });\n      httpServer.listen(config.server.port, host, function () {\n        if (onReady) {\n          onReady(httpServer);\n        }\n        Object.assign(websocketEndpoints, _objectSpread(_objectSpread({}, inspectorProxy ? _objectSpread({}, inspectorProxy.createWebSocketListeners(httpServer)) : {}), {}, {\n          \"/hot\": createWebsocketServer({\n            websocketServer: new MetroHmrServer(metroServer.getBundler(), metroServer.getCreateModuleId(), config)\n          })\n        }));\n        httpServer.on(\"upgrade\", function (request, socket, head) {\n          var _parse = (0, _url).parse(request.url),\n            pathname = _parse.pathname;\n          if (pathname != null && websocketEndpoints[pathname]) {\n            websocketEndpoints[pathname].handleUpgrade(request, socket, head, function (ws) {\n              websocketEndpoints[pathname].emit(\"connection\", ws, request);\n            });\n          } else {\n            socket.destroy();\n          }\n        });\n        if (inspectorProxy) {\n          serverApp.use(inspectorProxy.processRequest.bind(inspectorProxy));\n        }\n        resolve({\n          server: httpServer,\n          metro: metroServer\n        });\n      });\n      httpServer.timeout = 0;\n      httpServer.on(\"close\", function () {\n        end();\n      });\n    });\n  });\n  return function runServer(_x, _x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexports.runServer = runServer;","map":{"version":3,"names":["_defineProperty","require","_asyncToGenerator","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","_assert","_interopRequireDefault","_http","_https","_url","_env","_inspectorProxy","_resolveFromProject","runServer","_ref2","metroBundler","config","_ref","_ref$hasReducedPerfor","hasReducedPerformance","host","onError","onReady","secureServerOptions","_ref$waitForBundler","waitForBundler","_ref$websocketEndpoin","websocketEndpoints","watch","projectRoot","Metro","importMetroFromProject","createWebsocketServer","importMetroCreateWebsocketServerFromProject","MetroHmrServer","importMetroHmrServerFromProject","_yield$Metro$createCo","createConnectMiddleware","middleware","end","metroServer","default","use","serverApp","inspectorProxy","server","runInspectorProxy","env","EXPO_NO_INSPECTOR_PROXY","createInspectorProxy","_importMetroInspector","importMetroInspectorProxyFromProject","InspectorProxy","httpServer","createServer","Promise","resolve","reject","on","error","listen","port","assign","createWebSocketListeners","websocketServer","getBundler","getCreateModuleId","request","socket","head","_parse","parse","url","pathname","handleUpgrade","ws","emit","destroy","processRequest","bind","metro","timeout","_x","_x2","_x3"],"sources":["C:\\Users\\CR Laptop\\Desktop\\rn-project\\react_navigation\\node_modules\\@expo\\cli\\src\\start\\server\\metro\\runServer-fork.ts"],"sourcesContent":["// Copyright Â© 2023 650 Industries.\n// Copyright (c) Meta Platforms, Inc. and affiliates.\n//\n// Forks https://github.com/facebook/metro/blob/b80d9a0f638ee9fb82ff69cd3c8d9f4309ca1da2/packages/metro/src/index.flow.js#L57\n// and adds the ability to access the bundler instance.\nimport assert from 'assert';\nimport http from 'http';\nimport https from 'https';\nimport { RunServerOptions, Server } from 'metro';\nimport { ConfigT } from 'metro-config';\nimport type { InspectorProxy } from 'metro-inspector-proxy';\nimport { parse } from 'url';\n\nimport { env } from '../../../utils/env';\nimport type { ConnectAppType } from '../middleware/server.types';\nimport { MetroBundlerDevServer } from './MetroBundlerDevServer';\nimport { createInspectorProxy, ExpoInspectorProxy } from './inspector-proxy';\nimport {\n  importMetroCreateWebsocketServerFromProject,\n  importMetroFromProject,\n  importMetroHmrServerFromProject,\n  importMetroInspectorProxyFromProject,\n} from './resolveFromProject';\n\nexport const runServer = async (\n  metroBundler: MetroBundlerDevServer,\n  config: ConfigT,\n  {\n    hasReducedPerformance = false,\n    host,\n    onError,\n    onReady,\n    secureServerOptions,\n    waitForBundler = false,\n    websocketEndpoints = {},\n    watch,\n  }: RunServerOptions\n): Promise<{ server: http.Server | https.Server; metro: Server }> => {\n  const projectRoot = metroBundler.projectRoot;\n\n  const Metro = importMetroFromProject(projectRoot);\n\n  const createWebsocketServer = importMetroCreateWebsocketServerFromProject(projectRoot);\n\n  const MetroHmrServer = importMetroHmrServerFromProject(projectRoot);\n\n  // await earlyPortCheck(host, config.server.port);\n\n  // if (secure != null || secureCert != null || secureKey != null) {\n  //   // eslint-disable-next-line no-console\n  //   console.warn(\n  //     chalk.inverse.yellow.bold(' DEPRECATED '),\n  //     'The `secure`, `secureCert`, and `secureKey` options are now deprecated. ' +\n  //       'Please use the `secureServerOptions` object instead to pass options to ' +\n  //       \"Metro's https development server.\",\n  //   );\n  // }\n\n  const { middleware, end, metroServer } = await Metro.createConnectMiddleware(config, {\n    hasReducedPerformance,\n    waitForBundler,\n    watch,\n  });\n\n  assert(typeof (middleware as any).use === 'function');\n  const serverApp = middleware as ConnectAppType;\n\n  let inspectorProxy: InspectorProxy | ExpoInspectorProxy | null = null;\n  if (config.server.runInspectorProxy && !env.EXPO_NO_INSPECTOR_PROXY) {\n    inspectorProxy = createInspectorProxy(metroBundler, config.projectRoot);\n  } else if (config.server.runInspectorProxy) {\n    const { InspectorProxy } = importMetroInspectorProxyFromProject(projectRoot);\n    inspectorProxy = new InspectorProxy(config.projectRoot);\n  }\n\n  let httpServer: http.Server | https.Server;\n\n  if (secureServerOptions != null) {\n    httpServer = https.createServer(secureServerOptions, serverApp);\n  } else {\n    httpServer = http.createServer(serverApp);\n  }\n  return new Promise<{ server: http.Server | https.Server; metro: Server }>((resolve, reject) => {\n    httpServer.on('error', (error) => {\n      if (onError) {\n        onError(error);\n      }\n      reject(error);\n      end();\n    });\n\n    httpServer.listen(config.server.port, host, () => {\n      if (onReady) {\n        onReady(httpServer);\n      }\n\n      Object.assign(websocketEndpoints, {\n        ...(inspectorProxy ? { ...inspectorProxy.createWebSocketListeners(httpServer) } : {}),\n        '/hot': createWebsocketServer({\n          websocketServer: new MetroHmrServer(\n            metroServer.getBundler(),\n            metroServer.getCreateModuleId(),\n            config\n          ),\n        }),\n      });\n\n      httpServer.on('upgrade', (request, socket, head) => {\n        const { pathname } = parse(request.url!);\n        if (pathname != null && websocketEndpoints[pathname]) {\n          websocketEndpoints[pathname].handleUpgrade(request, socket, head, (ws) => {\n            websocketEndpoints[pathname].emit('connection', ws, request);\n          });\n        } else {\n          socket.destroy();\n        }\n      });\n\n      if (inspectorProxy) {\n        // TODO(hypuk): Refactor inspectorProxy.processRequest into separate request handlers\n        // so that we could provide routes (/json/list and /json/version) here.\n        // Currently this causes Metro to give warning about T31407894.\n        // $FlowFixMe[method-unbinding] added when improving typing for this parameters\n        serverApp.use(inspectorProxy.processRequest.bind(inspectorProxy));\n      }\n\n      resolve({ server: httpServer, metro: metroServer });\n    });\n\n    // Disable any kind of automatic timeout behavior for incoming\n    // requests in case it takes the packager more than the default\n    // timeout of 120 seconds to respond to a request.\n    httpServer.timeout = 0;\n\n    httpServer.on('close', () => {\n      end();\n    });\n  });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}